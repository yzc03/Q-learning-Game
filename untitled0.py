# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1w-SCvXTBrx3FzVldJER9NCkCmx9sO-cW
"""

!pip install pygame

import numpy as np
import random
import pygame
import time

GRID_SIZE = 5  # è¿·å®«å¤§å°
ACTIONS = ["UP", "DOWN", "LEFT", "RIGHT"]
ACTION_MAP = {"UP": (0, -1), "DOWN": (0, 1), "LEFT": (-1, 0), "RIGHT": (1, 0)}

# åˆå§‹åŒ– Q-table
Q_table = np.zeros((GRID_SIZE, GRID_SIZE, len(ACTIONS)))

# Q-learning å‚æ•°
alpha = 0.1  # å­¦ä¹ ç‡
gamma = 0.9  # æŠ˜æ‰£å› å­
epsilon = 1.0  # æ¢ç´¢ç‡
epsilon_decay = 0.99
min_epsilon = 0.1
episodes = 500  # è®­ç»ƒè½®æ•°

for episode in range(episodes):
    state = (0, 0)  # ä»£ç†èµ·å§‹ä½ç½®
    done = False

    while not done:
        # é€‰æ‹©åŠ¨ä½œï¼ˆÎµ-è´ªå¿ƒç­–ç•¥ï¼‰
        if random.uniform(0, 1) < epsilon:
            action_idx = random.randint(0, 3)  # éšæœºæ¢ç´¢
        else:
            action_idx = np.argmax(Q_table[state[0], state[1], :])  # é€‰æ‹©æœ€ä¼˜åŠ¨ä½œ

        # è®¡ç®—ä¸‹ä¸€çŠ¶æ€
        action = ACTIONS[action_idx]
        next_state = (state[0] + ACTION_MAP[action][0], state[1] + ACTION_MAP[action][1])

        # è¾¹ç•Œæ£€æµ‹
        if next_state[0] < 0 or next_state[0] >= GRID_SIZE or next_state[1] < 0 or next_state[1] >= GRID_SIZE:
            next_state = state  # æ’å¢™ä¿æŒåŸåœ°

        # å¥–åŠ±å‡½æ•°
        if next_state == (4, 4):  # ç›®æ ‡ä½ç½®
            reward = 100
            done = True
        elif next_state == state:  # æ’å¢™
            reward = -10
        else:
            reward = -1  # æ¯ä¸€æ­¥æ‰£åˆ†

        # Q-table æ›´æ–°
        Q_table[state[0], state[1], action_idx] = (1 - alpha) * Q_table[state[0], state[1], action_idx] + \
            alpha * (reward + gamma * np.max(Q_table[next_state[0], next_state[1], :]))

        state = next_state

    # è¡°å‡æ¢ç´¢ç‡
    epsilon = max(min_epsilon, epsilon * epsilon_decay)

print("è®­ç»ƒå®Œæˆï¼")


# åˆå§‹åŒ– Pygame
pygame.init()
CELL_SIZE = 100
screen = pygame.display.set_mode((GRID_SIZE * CELL_SIZE, GRID_SIZE * CELL_SIZE))

# é¢œè‰²
WHITE, BLACK, BLUE, GREEN = (255, 255, 255), (0, 0, 0), (0, 0, 255), (0, 255, 0)

def draw_game(agent_pos):
    screen.fill(WHITE)
    for x in range(GRID_SIZE):
        for y in range(GRID_SIZE):
            rect = pygame.Rect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE)
            pygame.draw.rect(screen, BLACK, rect, 1)

    # ç›®æ ‡
    pygame.draw.rect(screen, GREEN, (4 * CELL_SIZE, 4 * CELL_SIZE, CELL_SIZE, CELL_SIZE))

    # ä»£ç†
    pygame.draw.rect(screen, BLUE, (agent_pos[0] * CELL_SIZE, agent_pos[1] * CELL_SIZE, CELL_SIZE, CELL_SIZE))
    pygame.display.flip()

# ä»£ç†å†³ç­–
state = (0, 0)
running = True
while running:
    draw_game(state)
    pygame.time.delay(500)

    action_idx = np.argmax(Q_table[state[0], state[1], :])
    action = ACTIONS[action_idx]
    next_state = (state[0] + ACTION_MAP[action][0], state[1] + ACTION_MAP[action][1])

    if next_state == (4, 4):
        print("åˆ°è¾¾ç›®æ ‡ï¼")
        running = False
    else:
        state = next_state

pygame.quit()



from google.colab import auth
auth.authenticate_user()
!git config --global user.email "yuanzicheng03@163.com"
!git config --global user.name "yzc03"

!git init
!git remote add origin https://github.com/yzc03/Q-learning-Game.git
!git add .
!git commit -m "Initial commit"
!git branch -M main
!git push -u origin main

!git remote remove origin

!git remote add origin https://github.com/yzc03/Q-learning-Game.git

!echo "# Q-learning è¿·å®«æ¸¸æˆ" > README.md
!echo "## ğŸ® æ¸¸æˆç®€ä»‹" >> README.md
!echo "- ä½¿ç”¨ Q-learning è®­ç»ƒæ™ºèƒ½ä½“åœ¨è¿·å®«ä¸­æ‰¾åˆ°æœ€ä¼˜è·¯å¾„ã€‚" >> README.md
!echo "## ğŸ“œ ä¾èµ–" >> README.md
!echo "\`\`\`sh" >> README.md
!echo "pip install pygame numpy" >> README.md
!echo "\`\`\`" >> README.md
!echo "## ğŸ¥ æ¼”ç¤º" >> README.md
!echo "![æ¸¸æˆæ¼”ç¤º](demo.gif)" >> README.md
!git add README.md
!git commit -m "Add README"
!git push origin main

!git remote remove origin
!git remote add origin https://yzc03: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@github.com/yzc03/Q-learning-Game.git

!git push -u origin main

# Commented out IPython magic to ensure Python compatibility.
!git clone https://github.com/yzc03/Q-learning-Game.git
# %cd Q-learning-Game

python3 /content/Q-learning-Game/Q-learning-Game

ls /content/Q-learning-Game